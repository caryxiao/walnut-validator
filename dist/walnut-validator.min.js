/*!
 * walnut-validator.js v1.0.0
 * (c) 2016 Cary Xiao
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.WalnutValidator=t(e.jQuery)}(this,function(e){"use strict";e="default"in e?e["default"]:e;var t={};t["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},t.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var i=function(){function e(e,t,i,r){return e.filter(function(e){return e&&(!t||e.e===t||e.e.substr(0,e.e.indexOf("."))===t)&&(!i||e.cb===i||e.cb._cb===i)&&(!r||e.ctx===r)})}function t(e,t,i){(e||"").split(u).forEach(function(e){i(e,t)})}function i(e,t){for(var i,r=!1,n=-1,u=e.length;++n<u;)if(i=e[n],i.cb.apply(i.ctx2,t)===!1){r=!0;break}return!r}var r,n=[].slice,u=/\s+/;return r={on:function(e,i,r){var n,u=this;return i?(n=this._events||(this._events=[]),t(e,i,function(e,t){var i={e:e};i.cb=t,i.ctx=r,i.ctx2=r||u,i.id=n.length,n.push(i)}),this):this},once:function(e,i,r){var n=this;return i?(t(e,i,function(e,t){var i=function u(){return n.off(e,u),t.apply(r||n,arguments)};i._cb=t,n.on(e,i,r)}),n):n},off:function(i,r,n){var u=this._events;return u?i||r||n?(t(i,r,function(t,i){e(u,t,i,n).forEach(function(e){delete u[e.id]})}),this):(this._events=[],this):this},trigger:function(t){var r,u,a;return this._events&&t?(r=n.call(arguments,1),u=e(this._events,t),a=e(this._events,"all"),i(u,r)&&i(a,arguments)):this}},Object.assign({installTo:function(e){return Object.assign(e,r)}},r)},r=function(){function i(){t.classCallCheck(this,i),this._regulars={require:/.+/,number:/^[\-+]?(0|[1-9]\d*)(\.\d+)?$/,date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(10|11|12|13|14|15|16|17|18|19|20)\d{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,url:/^(http|https):\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@\[\]\':+!]*([^<>\"])*$/,ip:/^(0|[1-9]\d?|[0-1]\d{2}|2[0-4]\d|25[0-5]).(0|[1-9]\d?|[0-1]\d{2}|2[0-4]\d|25[0-5]).(0|[1-9]\d?|[0-1]\d{2}|2[0-4]\d|25[0-5]).(0|[1-9]\d?|[0-1]\d{2}|2[0-4]\d|25[0-5])$/,empty:/^\s*$/,letter:/^[a-zA-Z]{1,}$/,password:/^[a-zA-Z]\w{5,17}$/,trade_password:/^\d{6}$/,mobile:/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i,qq:/^[1-9][0-9]{4,}$/}}return t.createClass(i,[{key:"add",value:function(t){return e.extend(this._regulars,t||{}),this}},{key:"regulars",get:function(){return this._regulars}}]),i}(),n=document,u=function(){function e(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=r.el,u=void 0===n?null:n,a=r.rules,s=void 0===a?null:a,l=r.messages,o=void 0===l?null:l;t.classCallCheck(this,e);var h=new i;return h.installTo(this),this._status=!0,this.el=u,this.rules=s,this._message=null,this._messages={},this._error=null,this.triggerEvents=[],this.regulars={},this.$xhr=null,this._initMessages(o),this._handleQuery=null,this._handleLoading=null,this._handleShowPopup=null,this._handleHidePopup=null,this.init(),this}return t.createClass(e,[{key:"init",value:function(){this.$popup=n.querySelector('[aria-popup="'+this.Field.getAttribute("aria-popup-name")+'"]')}},{key:"setRegulars",value:function(e){return this.regulars=e,this}},{key:"setEvents",value:function(e){return this.triggerEvents=e,this}},{key:"setPopup",value:function(e){return this.$popup=e,this}},{key:"setHandleQuery",value:function(e){return this._handleQuery=e,this}},{key:"setHandleShowPopup",value:function(e){return this._handleShowPopup=e,this}},{key:"setHandleHidePopup",value:function(e){return this._handleHidePopup=e,this}},{key:"getQueryData",value:function(){var e={};return"function"==typeof this._handleQuery?e=this._handleQuery():"object"==t["typeof"](this._handleQuery)&&(e=this._handleQuery),e}},{key:"setHandleLoading",value:function(e){return this._handleLoading=e,this}},{key:"setStatus",value:function(e,t){return this._status=e,this._error=e?null:t,null!=this._error?(this._message=void 0==this._messages[this.error]?null:this._messages[this.error],this.showPopup()):(this._message=null,this.hidePopup()),this}},{key:"_initMessages",value:function(e){if(null!=e&&Object.keys(e).length>0)for(var t in e){var i=t.split(","),r=!0,n=!1,u=void 0;try{for(var a,s=i[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;this._messages[l]=e[i]}}catch(o){n=!0,u=o}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw u}}}}},{key:"val",value:function(){return-1==["checkbox","radio"].indexOf(this.Field.getAttribute("type"))?this.Field.value:void 0}},{key:"showPopup",value:function(){null!=this.$popup&&("function"==typeof this._handleShowPopup?this._handleShowPopup(this,this.message):(this.$popup.innerHTML=this.message,this.$popup.style.display="block")),this.trigger("afterShowPopup",this)}},{key:"hidePopup",value:function(){null!=this.$popup&&("function"==typeof this._handleHidePopup?this._handleHidePopup(this):(this.$popup.innerHTML="",this.$popup.style.display="none")),this.trigger("afterHidePopup",this)}},{key:"validating",value:function(e){null!=this._handleLoading?"function"==typeof this._handleLoading&&(this.hidePopup(),this._handleLoading(e,this)):e?null!=this.$popup&&(this.$popup.innerHTML="loading...",this.$popup.style.display="block"):this.hidePopup()}},{key:"Field",get:function(){return this.el[0]}},{key:"status",get:function(){return this._status}},{key:"error",get:function(){return this._error}},{key:"message",get:function(){return this._message}}]),e}(),a=function(){function i(){t.classCallCheck(this,i)}return t.createClass(i,[{key:"required",value:function(e){var t=e.el;return["checkbox","radio"].indexOf(e.Field.getAttribute("type"))>-1?function(){var e=!1,i=!0,r=!1,n=void 0;try{for(var u,a=t[Symbol.iterator]();!(i=(u=a.next()).done);i=!0){var s=u.value;if(s.matches(":checked")){e=!0;break}}}catch(l){r=!0,n=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw n}}return e}():""!=e.val()}},{key:"regular",value:function(e,t,i){var r=e.val(),n=void 0;if(""==r)return!0;if(void 0!=e.regulars[t])n=e.regulars[t];else{if(void 0==i[t])throw new Error("Not Found regulars:"+t);n=i[t]}return n.global&&(n.lastIndex=0),n.test(r)}},{key:"min",value:function(e,t){var i=e.val();return""==i?!0:i.length>=t}},{key:"max",value:function(e,t){var i=e.val();return""==i?!0:i.length<=t}},{key:"remote",value:function(t,i){var r=t.val();if(""==r)return!0;t.validating(!0);var n=i,u={fieldValue:r};return u=Object.assign({},u,t.getQueryData()||{}),t.$xhr=e.ajax({url:n,data:u,type:"get",dataType:"json",success:function(e){t.validating(!1),e.validate?t.setStatus(!0).hidePopup():t.setStatus(!1,"remote").showPopup()}}),"validating"}},{key:"customHandle",value:function(e,t){return t.call(null,e)}},{key:"sameTo",value:function(e,t,i){var r=this._searchFieldBase(i,t);if(void 0!=r)return e.val()==r.val();throw new Error("Not Found regulars:"+t)}},{key:"_searchFieldBase",value:function(e,t){var i=void 0,r=!0,n=!1,u=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;if(l.Field==t[0]){i=l;break}}}catch(o){n=!0,u=o}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw u}}return i}}]),i}(),s=document,l=function(){function n(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],u=e.form,l=void 0===u?null:u,o=e.regulars,h=void 0===o?{}:o,d=e.customFuncs,f=void 0===d?{}:d,c=e.handleShowPopup,v=void 0===c?null:c,p=e.handleHidePopup,F=void 0===p?null:p,y=e.fieldHooks,g=void 0===y?{}:y;t.classCallCheck(this,n),this.$form=s.querySelectorAll(l),this.$fieldsBase=[];var m=new i;m.installTo(this),this.$regulars=new r,this.$regulars.add(h),this.$customFuns=f,this.handleShowPopup=v,this.handleHidePopup=F,this.fieldHooks=g,this.$validateHandle=new a}return t.createClass(n,[{key:"addField",value:function(t,i,r){var n=this,a=new u({el:this._getElement(t),rules:i,messages:r}).setHandleShowPopup(this.handleShowPopup).setHandleHidePopup(this.handleHidePopup);"function"==typeof this.afterShowPopup&&a.on("afterShowPopup");var s=!0,l=!1,o=void 0;try{for(var h,d=Object.keys(this.fieldHooks)[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var f=h.value;a.on(f,this.fieldHooks[f])}}catch(c){l=!0,o=c}finally{try{!s&&d["return"]&&d["return"]()}finally{if(l)throw o}}return this.$fieldsBase.push(a),a.triggerEvents.length&&e.each(a.triggerEvents,function(e,t){a.Field.on(t,function(){n.validateField(a)})}),a}},{key:"_getElement",value:function(e){var t=void 0;return t=null==this.$form?this.$form.querySelectorAll(e):s.querySelectorAll(e)}},{key:"validateField",value:function(e){if(null!=e.Field){var t=!0,i=void 0,r=e.rules;for(var n in r){var u=r[n];if("required"==n){if(t=this.$validateHandle.required(e),!t){i=n;break}}else if("regular"==n){var a=u.split(","),s=!0,l=!1,o=void 0;try{for(var h,d=a[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var f=h.value;if(t=this.$validateHandle.regular(e,f,this.$regulars.regulars),!t){i=f;break}}}catch(c){l=!0,o=c}finally{try{!s&&d["return"]&&d["return"]()}finally{if(l)throw o}}if(!t)break}else if(0===n.indexOf("custom")){if("string"==typeof u&&"function"==typeof this.$customFuns[u]&&(u=this.$customFuns[u]),t=this.$validateHandle.customHandle(e,u),!t){i=n;break}}else if("sameTo"==n){if(t=this.$validateHandle.sameTo(e,this._getElement(u),this.$fieldsBase),!t){i=n;break}}else{if("remote"==n){t=this.$validateHandle.remote(e,u);break}if("function"==typeof this.$validateHandle[n]&&(t=this.$validateHandle[n](e,u),!t)){i=n;break}}}"validating"!=t&&e.setStatus(t,i)}}},{key:"validateAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.$fieldsBase[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var u=r.value;u.init(),this.validateField(u)}}catch(a){t=!0,i=a}finally{try{!e&&n["return"]&&n["return"]()}finally{if(t)throw i}}}},{key:"submit",value:function(){var t=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];this.validateAll();var i=this._getFieldsXHR();i.length>0?e.when.apply({},i).done(function(){this.trigger("afterValidate"),this._hasError()||(t(),this.trigger("submit"))}.bind(this)):(this.trigger("afterValidate"),this._hasError()||(t(),this.trigger("submit")))}},{key:"_getFieldsXHR",value:function(){var e=[],t=!0,i=!1,r=void 0;try{for(var n,u=this.$fieldsBase[Symbol.iterator]();!(t=(n=u.next()).done);t=!0){var a=n.value;null!=a.$xhr&&e.push(a.$xhr)}}catch(s){i=!0,r=s}finally{try{!t&&u["return"]&&u["return"]()}finally{if(i)throw r}}return e}},{key:"_hasError",value:function(){var e=!1,t=!0,i=!1,r=void 0;try{for(var n,u=this.$fieldsBase[Symbol.iterator]();!(t=(n=u.next()).done);t=!0){var a=n.value;if(!a.status){e=!0;break}}}catch(s){i=!0,r=s}finally{try{!t&&u["return"]&&u["return"]()}finally{if(i)throw r}}return e}}]),n}();return l});